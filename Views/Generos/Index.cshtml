@model IEnumerable<VideoClub.Models.Generos>
@using VideoClub.Models


@{
    ViewData["Title"] = "Géneros";
}

<div class="Content grid [grid-template-rows:100px_1fr_auto] [grid-template-areas:'header'_'main'_'footer']">
    
    <header class="[grid-area:header]">
        <div class="">
            <h1 class="text-2xl font-bold py-5 px-8">Géneros</h1>
        </div>
    </header>

    <main class="[grid-area:main]">

        <div class="mb-10 container mx-auto">
           </div>
           <div class="container mx-auto shadow-2xl rounded-lg bg-white pb-4">
              <div class="mb-5 pt-5">
                 <div class="flex justify-between">
                    <div>
                       <span class="text-2xl py-5 px-8 font-semibold text-gray-700">Listado</span>
                    </div>

                 <div class="px-4 mb-5">
                    <button onclick="toggleModal(true)" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors duration-200 flex items-center gap-1">
                    + &nbsp;Nuevo Género
                    </button>
                 </div>

                 </div>
                 <div id="modal-create" class="fixed inset-0 z-50 flex items-center justify-center transition-all duration-300 ease-in-out opacity-0 invisible">
                    <div onclick="event.stopPropagation()" class="absolute inset-0 bg-black/50 transition-opacity duration-300"></div>
                    <div id="modal-content-create" class="relative flex flex-col h-[calc(100vh-100px)] lg:h-auto max-h-[90vh] w-full max-w-3xl bg-white rounded-md shadow-lg transition-all duration-300 ease-in-out transform scale-95 translate-y-4">
                       <div class="w-full px-4 mx-auto flex flex-col h-full overflow-hidden">
                          <!-- Botón de cerrar X -->
                          <button onclick="toggleModal(false)" class="absolute top-4 right-4 text-gray-400 hover:text-gray-500 z-10 transition-colors">
                             <span class="sr-only">Cerrar</span>
                             <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                             </svg>
                          </button>
                          
                          <div class="flex border-b shrink-0 pt-4">
                             <button class="tab-btn px-4 py-2 border-b-2 font-medium text-blue-600 border-blue-600">
                             Nuevo Género
                             </button>
                          </div>

                          <!-- Contenido del modal -->
                          <div class="mt-4 flex-1 flex flex-col min-h-0">
                             <div class="flex flex-col h-full min-h-0 border text-sm">
                                 <form asp-action="Create" asp-controller="Generos" method="post" class="flex flex-col h-full min-h-0 p-4">
                                      <div class="flex-1 min-h-0 overflow-y-auto">
                                         <div class="flex flex-col gap-4">
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <!-- Descripción -->
                                                <div class="flex flex-col">
                                                   <label class="mb-1 font-medium text-gray-700">Descripción</label>
                                                   <input type="text" name="Descripcion" required placeholder="Escribe la descripción..." class="w-full px-4 py-2 bg-white font-mono border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-200 transition-all shadow-sm" />
                                                </div>
                                                <!-- Estado -->
                                                <div class="flex flex-col">
                                                   <label class="mb-1 font-medium text-gray-700">Estado</label>
                                                   <div class="relative">
                                                      <select name="estado" required class="block w-full appearance-none rounded-md bg-white px-4 py-2 pr-10 font-mono text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-200">
                                                         <option value="1" class="text-green-500">Activo</option>
                                                         <option value="0" class="text-red-500">Inactivo</option>
                                                      </select>
                                                      <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2">
                                                         <svg class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                                                            <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                                                         </svg>
                                                      </div>
                                                   </div>
                                                </div>
                                            </div>
                                         </div>
                                      </div>
                                      <div class="flex justify-end mt-4 pt-4 border-t">
                                         <div class="px-2">
                                            <button type="button" class="px-4 py-2 text-gray-600 rounded-md bg-gray-100 hover:bg-gray-200 transition-all duration-300 font-medium font-mono"
                                               onclick="toggleModal(false)">
                                            Cancelar
                                            </button>
                                         </div>
                                         <div class="px-2">
                                            <button type="submit" class="bg-blue-600 px-4 py-2 text-white rounded-md hover:bg-blue-700 shadow-sm transition-all duration-300 font-medium font-mono">
                                            Guardar
                                            </button>
                                         </div>
                                      </div>
                                   </form>
                             </div>
                          </div>
                       </div>
                    </div>
                 </div>

              </div>

              <div class="mb-5 px-8">
                 <input type="text" id="searchInput" onkeyup="filterTable()" placeholder="Buscar..." class="w-full px-4 py-2 bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-200 transition-all" />
              </div>
              <div class="px-8 mb-5">
                 <div class="overflow-x-auto border border-gray-200 rounded-lg">
                    <table class="min-w-full divide-y divide-gray-200">
                       <thead class="bg-gray-100">
                          <tr>
                             <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                             <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Descripción</th>
                             <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                             <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                          </tr>
                       </thead>
                       <tbody id="dataTableBody" class="bg-white divide-y divide-gray-200">
                       @foreach (var item in Model) {
                          <tr key="@item.Id" class="hover:bg-gray-50 transition-colors">
                             <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">@item.Id</td>
                             <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">@item.Descripcion</td>
                             <td class="px-6 py-4 whitespace-nowrap">
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full
                                @(item.Estado == Generos.EstadoGenero.Activo ? "bg-green-100 text-green-800" : "bg-red-100 text-red-800")">

                                @item.Estado
                                </span>
                             </td>
                             <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                <a onclick="handleData(@item.Id, true)" class="text-blue-600 hover:text-blue-900 mr-3 hover:cursor-pointer transition-colors"><svg class="w-5 h-5 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg></a>
                                <a onclick="deleteData(@item.Id)" class="text-red-500 hover:text-red-700 hover:cursor-pointer transition-colors"><svg class="w-5 h-5 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></a>
                             </td>
                          </tr>
                       }

                       </tbody>
                    </table>
                 </div>
              </div>
           </div>

     <div id="modal-update" class="fixed inset-0 z-50 flex items-center justify-center transition-all duration-300 ease-in-out opacity-0 invisible">
              <div onclick="event.stopPropagation()" class="absolute inset-0 bg-black/50 transition-opacity duration-300"></div>
              <div id="modal-content-update" class="relative flex flex-col h-[calc(100vh-100px)] lg:h-auto max-h-[90vh] w-full max-w-3xl bg-white rounded-md shadow-lg transition-all duration-300 ease-in-out transform scale-95 translate-y-4">
                 <div class="w-full px-4 mx-auto flex flex-col h-full overflow-hidden">
                    <button onclick="handleData(null, false)" class="absolute top-4 right-4 text-gray-400 hover:text-gray-500 z-10 transition-colors">
                       <span class="sr-only">Cerrar</span>
                       <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                       </svg>
                    </button>
                    
                    <div class="flex border-b shrink-0 pt-4">
                       <button class="tab-btn px-4 py-2 border-b-2 font-medium text-blue-600 border-blue-600">
                       Editar Género
                       </button>
                    </div>

                    <div class="mt-4 flex-1 flex flex-col min-h-0">
                       <div class="flex flex-col h-full min-h-0 border text-sm">
                           <form id="formGeneroUpdate" class="flex flex-col h-full min-h-0 p-4" onsubmit="event.preventDefault(); updateData();">
                                <input type="hidden" id="Id" name="Id" />
                                <div class="flex-1 min-h-0 overflow-y-auto">
                                   <div class="flex flex-col gap-4">
                                      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                          <!-- Descripción -->
                                          <div class="flex flex-col">
                                             <label class="mb-1 font-medium text-gray-700">Descripción</label>
                                             <input type="text" id="Descripcion" name="Descripcion" required placeholder="Escribe la descripción..." class="w-full px-4 py-2 bg-white font-mono border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-200 transition-all shadow-sm" />
                                          </div>
                                          <!-- Estado -->
                                          <div class="flex flex-col">
                                             <label class="mb-1 font-medium text-gray-700">Estado</label>
                                             <div class="relative">
                                                <select id="Estado" name="Estado" required class="block w-full appearance-none rounded-md bg-white px-4 py-2 pr-10 font-mono text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-200">
                                                   <option value="1" class="text-green-500">Activo</option>
                                                   <option value="0" class="text-red-500">Inactivo</option>
                                                </select>
                                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2">
                                                   <svg class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                                                      <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                                                   </svg>
                                                </div>
                                             </div>
                                          </div>
                                      </div>
                                   </div>
                                </div>
                                <div class="flex justify-end mt-4 pt-4 border-t">
                                   <div class="px-2">
                                      <button type="button" class="px-4 py-2 text-gray-600 rounded-md bg-gray-100 hover:bg-gray-200 transition-all duration-300 font-medium font-mono"
                                         onclick="handleData(null, false)">
                                      Cancelar
                                      </button>
                                   </div>
                                   <div class="px-2">
                                      <button type="submit" class="bg-blue-600 px-4 py-2 text-white rounded-md hover:bg-blue-700 shadow-sm transition-all duration-300 font-medium font-mono">
                                      Guardar
                                      </button>
                                   </div>
                                </div>
                             </form>
                       </div>
                    </div>
                 </div>
              </div>
           </div>

    </main>
    
    <footer class="[grid-area:footer]"></footer>

    <script>
         function filterTable() {
       const input = document.getElementById("searchInput");
       const filter = input.value.toLowerCase().normalize("NFD").replace(/[̀-ͯ]/g, "");
       const tbody = document.getElementById("dataTableBody");
       const trs = tbody.getElementsByTagName("tr");

       for (let i = 0; i < trs.length; i++) {
           const tds = trs[i].getElementsByTagName("td");
           let visible = false;
           // Exclude the last column (Acciones) from filtering
           for (let j = 0; j < (tds.length - 1); j++) {
               if (tds[j]) {
                   const cellText = tds[j].innerText.toLowerCase().normalize("NFD").replace(/[̀-ͯ]/g, "");
                   if (cellText.indexOf(filter) > -1) {
                       visible = true;
                       break;
                   }
               }
           }
           trs[i].style.display = visible ? "" : "none";
       }
   }

         function deleteData(id) {
             if(!confirm('¿Estás seguro de eliminar el género?')) return;

             fetch('/Generos/Delete', {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(parseInt(id))
            })
            .then(response => {
                if (response.ok) {
                    location.reload();
                } else {
                    alert('Error deleting data');
                }
            })
            .catch(error => console.error('Error:', error));
          }

         function updateData() {
            const id = document.getElementById('Id').value;
            const descripcion = document.getElementById('Descripcion').value;
            const estado = document.getElementById('Estado').value;

            const data = {
                id: parseInt(id),
                descripcion: descripcion,
                estado: parseInt(estado)
            };

            fetch('/Generos/Update', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                if (response.ok) {
                    location.reload();
                } else {
                    alert('Error updating data');
                }
            })
            .catch(error => console.error('Error:', error));
          }

         function handleData(id, show){
             const overlay = document.getElementById('modal-update');
             const content = document.getElementById('modal-content-update');

             if (!show) {
                 overlay.classList.remove('visible', 'opacity-100');
                 overlay.classList.add('invisible', 'opacity-0');
                 content.classList.remove('scale-100', 'translate-y-0');
                 content.classList.add('scale-95', 'translate-y-4');
                 return;
             }

            var allData = @Html.Raw(Json.Serialize(Model));
            var data = allData.find(item => item.id == id);
            document.getElementById('Descripcion').value = data.descripcion;
            document.getElementById('Estado').value = data.estado;
            document.getElementById('Id').value = data.id;

             overlay.classList.remove('invisible', 'opacity-0');
             overlay.classList.add('visible', 'opacity-100');
             content.classList.remove('scale-95', 'translate-y-4');
             content.classList.add('scale-100', 'translate-y-0');
         }


         function toggleModal(show) {
             const overlay = document.getElementById('modal-create');
             const content = document.getElementById('modal-content-create');

             if (show) {

                 overlay.classList.remove('invisible', 'opacity-0');
                 overlay.classList.add('visible', 'opacity-100');

                 content.classList.remove('scale-95', 'translate-y-4');
                 content.classList.add('scale-100', 'translate-y-0');
             } else {

                 overlay.classList.remove('visible', 'opacity-100');
                 overlay.classList.add('invisible', 'opacity-0');

                 content.classList.remove('scale-100', 'translate-y-0');
                 content.classList.add('scale-95', 'translate-y-4');
             }
         }
      </script>
</div>